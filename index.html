<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project 45 â€“ Study Material</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root {
  --bg1: #041024;
  --bg2: #071226;
  --glass: rgba(255,255,255,0.06);
  --accent: #10b981;
  --card-bg: rgba(255,255,255,0.05);
}

body {
  background: linear-gradient(180deg, var(--bg1), var(--bg2));
  min-height: 100vh;
}

/* Banner */
.banner-slide {
  width: 100%;
  height: 180px;
  object-fit: cover;
  border-radius: 16px;
}

/* Cards */
.card {
  background: var(--card-bg);
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid var(--glass);
  transition: .3s;
}
.card:hover { transform: translateY(-6px); }

.poster {
  width: 100%;
  height: 160px;
  object-fit: cover;
}

.tab-btn {
  border-radius: 10px;
  padding: 8px 16px;
  background: linear-gradient(90deg,#0ea5a4,#10b981);
  color:#071226;
  font-weight:600;
}

.open-link {
  display:inline-block;
  padding:8px 12px;
  background:linear-gradient(90deg,#0ea5a4,#10b981);
  color:#071226;
  margin-top:10px;
  border-radius:8px;
  font-weight:600;
}

/* POPUP */
#popup {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.popup-box {
  background: #0f1b33;
  padding: 25px;
  width: 90%;
  max-width: 380px;
  border-radius: 18px;
  text-align: center;
  border: 1px solid #1f2d4d;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}
.popup-thumb {
  width: 100%;
  height: 180px;
  object-fit: cover;
  border-radius: 12px;
  margin: 15px 0;
  border: 2px solid #10b981;
}
.close-btn {
  margin-top: 20px;
  padding: 10px 24px;
  background: linear-gradient(90deg,#0ea5a4,#10b981);
  color: #0f1b33;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  border: none;
  width: 100%;
}
</style>
</head>

<body class="text-white">

<header class="p-4 text-center text-3xl font-bold text-emerald-400">
  Project 45 â€“ Study Resources
</header>

<!-- POPUP -->
<div id="popup">
  <div class="popup-box">
    <h2 class="text-xl font-bold mb-2">ðŸŽ‰ New Content Added!</h2>
    <img id="popup-thumb" class="popup-thumb" src="https://via.placeholder.com/350x180/0f1b33/10b981?text=Thumbnail">
    <p id="popup-title" class="mt-3 text-lg font-semibold text-emerald-300"></p>
    <button class="close-btn" onclick="closePopup()">Continue</button>
  </div>
</div>

<!-- BANNERS -->
<div id="banner-area" class="p-4 space-y-4"></div>

<!-- CATEGORY SELECT -->
<div class="p-4">
  <label class="text-gray-300 text-lg">Select Category:</label>
  <select id="category-filter" class="w-full p-3 rounded bg-[#0d1a33] border border-[#1a2747] text-white mt-2"></select>
</div>

<!-- TABS -->
<div class="flex justify-center gap-4 my-4 px-4">
  <button class="tab-btn" onclick="showSection('projects')">Projects</button>
  <button class="tab-btn" onclick="showSection('notes')">Notes</button>
  <button class="tab-btn" onclick="showSection('dpp')">DPP</button>
</div>

<div class="p-4">

  <!-- PROJECTS -->
  <div id="projects-section" class="section">
    <h2 class="text-xl font-bold mb-4 text-emerald-300">Projects</h2>
    <div id="projects-list" class="grid grid-cols-2 gap-4"></div>
  </div>

  <!-- NOTES -->
  <div id="notes-section" class="section hidden">
    <h2 class="text-xl font-bold mb-4 text-emerald-300">Notes</h2>
    <div id="notes-list" class="grid grid-cols-2 gap-4"></div>
  </div>

  <!-- DPP -->
  <div id="dpp-section" class="section hidden">
    <h2 class="text-xl font-bold mb-4 text-emerald-300">Daily Practice Papers</h2>
    <div id="dpp-list" class="grid grid-cols-2 gap-4"></div>
  </div>

</div>

<script>
// ---------------- FIREBASE ----------------
const firebaseConfig = {
  apiKey: "AIzaSyA8Ck4k7gMfn9oU1nq-JBijML1JE6yVx84",
  authDomain: "project45-627cc.firebaseapp.com",
  databaseURL: "https://project45-627cc-default-rtdb.firebaseio.com",
  projectId: "project45-627cc",
  storageBucket: "project45-627cc.appspot.com",
  messagingSenderId: "850515567224",
  appId: "1:850515567224:web:bcbed252ee8596c08fc38d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let allCategories = {}, allProjects = {}, allNotes = {}, allDpp = {};

function showSection(sec){
  document.querySelectorAll(".section").forEach(s => s.classList.add("hidden"));
  document.getElementById(sec + "-section").classList.remove("hidden");
}

// -------------- POPUP -----------------
function openPopup(title, thumb){
  document.getElementById("popup-title").innerText = title;
  document.getElementById("popup-thumb").src = thumb;
  document.getElementById("popup").style.display = "flex";
}

function closePopup(){
  document.getElementById("popup").style.display = "none";
}

// ----------- BANNERS ----------- 
function loadBanners(){
  const area = document.getElementById("banner-area");
  area.innerHTML = "";

  db.ref("banners").on("value", snap => {
    area.innerHTML = "";
    snap.forEach(child => {
      const url = child.val().url;
      if(url) {
        area.innerHTML += `<img src="${url}" class="banner-slide">`;
      }
    });
    
    // If no banners, show placeholder
    if(area.innerHTML === "") {
      area.innerHTML = `
        <div class="banner-slide bg-gradient-to-r from-emerald-900 to-teal-800 flex items-center justify-center">
          <p class="text-xl font-bold">Study Resources</p>
        </div>
      `;
    }
  });
}

// ----------- CATEGORY DROPDOWN ----------- 
function loadCategories(){
  const select = document.getElementById("category-filter");
  select.innerHTML = `<option value="">All Categories</option>`;

  db.ref("categories").on("value", snap => {
    select.innerHTML = `<option value="">All Categories</option>`;
    snap.forEach(child => {
      const name = child.val().name;
      allCategories[child.key] = name;
      select.innerHTML += `<option value="${name}">${name}</option>`;
    });
    renderAll();
  });

  select.addEventListener("change", renderAll);
}

// ----------- PROJECTS ----------- 
function renderProjects(){
  const list = document.getElementById("projects-list");
  const filter = document.getElementById("category-filter").value;
  list.innerHTML = "";

  Object.entries(allProjects).forEach(([id, p]) => {
    if(filter && p.category !== filter) return;

    list.innerHTML += `
      <div class="card">
        <img src="${p.posterUrl || 'https://via.placeholder.com/300x160/0f1b33/10b981?text=Project'}" 
             class="poster" alt="${p.title}">
        <div class="p-3">
          <p class="font-bold text-sm">${p.title}</p>
          <p class="text-gray-400 text-xs mt-1">${p.year || ''}</p>
          ${p.watchLink ? 
            `<a href="${p.watchLink}" target="_blank" class="open-link text-xs">Watch</a>` : 
            '<p class="text-gray-500 text-xs mt-2">No link available</p>'
          }
        </div>
      </div>
    `;
  });
  
  if(list.innerHTML === "") {
    list.innerHTML = `<p class="col-span-2 text-center text-gray-400 p-4">No projects found</p>`;
  }
}

// ----------- NOTES ----------- 
function renderNotes(){
  const list = document.getElementById("notes-list");
  const filter = document.getElementById("category-filter").value;
  list.innerHTML = "";

  Object.entries(allNotes).forEach(([id, n]) => {
    if(filter && n.category !== filter) return;

    list.innerHTML += `
      <div class="card p-3">
        <p class="font-bold text-sm mb-2">${n.title}</p>
        ${n.url ? 
          `<a href="${n.url}" target="_blank" class="open-link text-xs">Open Notes</a>` : 
          '<p class="text-gray-500 text-xs">Link coming soon</p>'
        }
      </div>
    `;
  });
  
  if(list.innerHTML === "") {
    list.innerHTML = `<p class="col-span-2 text-center text-gray-400 p-4">No notes found</p>`;
  }
}

// ----------- DPP ----------- 
function renderDpp(){
  const list = document.getElementById("dpp-list");
  const filter = document.getElementById("category-filter").value;
  list.innerHTML = "";

  Object.entries(allDpp).forEach(([id, d]) => {
    if(filter && d.category !== filter) return;

    list.innerHTML += `
      <div class="card p-3">
        <p class="font-bold text-sm mb-2">${d.title}</p>
        ${d.url ? 
          `<a href="${d.url}" target="_blank" class="open-link text-xs">Open DPP</a>` : 
          '<p class="text-gray-500 text-xs">Link coming soon</p>'
        }
      </div>
    `;
  });
  
  if(list.innerHTML === "") {
    list.innerHTML = `<p class="col-span-2 text-center text-gray-400 p-4">No DPP found</p>`;
  }
}

let firstLoad = true;

// ----------- LIVE FIREBASE DATA ----------- 
function startLive(){
  db.ref("projects").on("value", snap => {
    const oldCount = Object.keys(allProjects).length;
    allProjects = snap.val() || {};
    const newCount = Object.keys(allProjects).length;

    if(!firstLoad && newCount > oldCount){
      const lastItem = Object.values(allProjects).slice(-1)[0];
      // Use posterUrl if available, otherwise use default thumbnail
      const thumbnail = lastItem.posterUrl || 
                       "https://via.placeholder.com/350x180/0f1b33/10b981?text=New+Project";
      openPopup(lastItem.title || "New Project Added", thumbnail);
    }
    renderProjects();
  });

  db.ref("notes").on("value", snap => {
    const oldCount = Object.keys(allNotes).length;
    allNotes = snap.val() || {};
    const newCount = Object.keys(allNotes).length;

    if(!firstLoad && newCount > oldCount){
      const lastItem = Object.values(allNotes).slice(-1)[0];
      // For notes, use thumbnail or posterUrl, or default
      const thumbnail = lastItem.thumbnail || 
                       lastItem.posterUrl || 
                       "https://via.placeholder.com/350x180/0f1b33/10b981?text=New+Notes";
      openPopup(lastItem.title || "New Notes Added", thumbnail);
    }
    renderNotes();
  });

  db.ref("dpp").on("value", snap => {
    const oldCount = Object.keys(allDpp).length;
    allDpp = snap.val() || {};
    const newCount = Object.keys(allDpp).length;

    if(!firstLoad && newCount > oldCount){
      const lastItem = Object.values(allDpp).slice(-1)[0];
      // For DPP, use thumbnail or posterUrl, or default
      const thumbnail = lastItem.thumbnail || 
                       lastItem.posterUrl || 
                       "https://via.placeholder.com/350x180/0f1b33/10b981?text=New+DPP";
      openPopup(lastItem.title || "New DPP Added", thumbnail);
    }
    renderDpp();
  });

  firstLoad = false;
}

function renderAll(){
  renderProjects();
  renderNotes();
  renderDpp();
}

// INITIALIZE EVERYTHING
window.onload = function() {
  loadBanners();
  loadCategories();
  startLive();
  showSection('projects');
  
  // Add error handling for popup image
  document.getElementById('popup-thumb').onerror = function() {
    this.src = "https://via.placeholder.com/350x180/0f1b33/10b981?text=Content+Added";
  };
};
</script>

</body>
</html>
