<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project 45 – Study Material</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root {
  --bg1: #041024;
  --bg2: #071226;
  --glass: rgba(255,255,255,0.06);
  --accent: #10b981;
  --card-bg: rgba(255,255,255,0.05);
}

body {
  background: linear-gradient(180deg, var(--bg1), var(--bg2));
}

/* Banner */
.banner-slide {
  width: 100%;
  height: 180px;
  object-fit: cover;
  border-radius: 16px;
}

/* Cards */
.card {
  background: var(--card-bg);
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid var(--glass);
  transition: .3s;
}
.card:hover { transform: translateY(-6px); }

.poster {
  width: 100%;
  height: 160px;
  object-fit: cover;
}

.tab-btn {
  border-radius: 10px;
  padding: 8px 16px;
  background: linear-gradient(90deg,#0ea5a4,#10b981);
  color:#071226;
  font-weight:600;
}

.open-link {
  display:inline-block;
  padding:8px 12px;
  background:linear-gradient(90deg,#0ea5a4,#10b981);
  color:#071226;
  margin-top:10px;
  border-radius:8px;
  font-weight:600;
}

/* POPUP */
#popup {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.75);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.popup-box {
  background: #0f1b33;
  padding: 20px;
  width: 90%;
  max-width: 350px;
  border-radius: 14px;
  text-align: center;
  border: 1px solid #1f2d4d;
}
.popup-thumb {
  width: 100%;
  height: 160px;
  object-fit: cover;
  border-radius: 10px;
}
.close-btn {
  margin-top: 14px;
  padding: 8px 18px;
  background: #10b981;
  color: #0f1b33;
  border-radius: 8px;
  font-weight: 600;
}
</style>
</head>

<body class="text-white">

<header class="p-4 text-center text-3xl font-bold text-emerald-400">
  Project 45 – Study Resources
</header>

<!-- POPUP -->
<div id="popup">
  <div class="popup-box">
    <h2 class="text-xl font-bold mb-2">New Lecture Added</h2>
    <img id="popup-thumb" class="popup-thumb">
    <p id="popup-title" class="mt-3 text-lg font-semibold"></p>
    <button class="close-btn" onclick="closePopup()">OK</button>
  </div>
</div>

<!-- BANNERS -->
<div id="banner-area" class="p-4 space-y-4"></div>

<!-- CATEGORY SELECT -->
<div class="p-4">
  <label class="text-gray-300 text-lg">Select Category:</label>
  <select id="category-filter" class="w-full p-3 rounded bg-[#0d1a33] border border-[#1a2747] text-white mt-2"></select>
</div>

<!-- TABS -->
<div class="flex justify-center gap-4 my-4">
  <button class="tab-btn" onclick="showSection('projects')">Projects</button>
  <button class="tab-btn" onclick="showSection('notes')">Notes</button>
  <button class="tab-btn" onclick="showSection('dpp')">DPP</button>
</div>

<div class="p-4">

  <!-- PROJECTS -->
  <div id="projects-section" class="section">
    <h2 class="text-xl font-bold mb-4">Projects</h2>
    <div id="projects-list" class="grid grid-cols-2 gap-4"></div>
  </div>

  <!-- NOTES -->
  <div id="notes-section" class="section hidden">
    <h2 class="text-xl font-bold mb-4">Notes</h2>
    <div id="notes-list" class="grid grid-cols-2 gap-4"></div>
  </div>

  <!-- DPP -->
  <div id="dpp-section" class="section hidden">
    <h2 class="text-xl font-bold mb-4">Daily Practice Papers</h2>
    <div id="dpp-list" class="grid grid-cols-2 gap-4"></div>
  </div>

</div>

<script>
// ---------------- FIREBASE ----------------
const firebaseConfig = {
  apiKey: "AIzaSyA8Ck4k7gMfn9oU1nq-JBijML1JE6yVx84",
  authDomain: "project45-627cc.firebaseapp.com",
  databaseURL: "https://project45-627cc-default-rtdb.firebaseio.com",
  projectId: "project45-627cc",
  storageBucket: "project45-627cc.appspot.com",
  messagingSenderId: "850515567224",
  appId: "1:850515567224:web:bcbed252ee8596c08fc38d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let allCategories={}, allProjects={}, allNotes={}, allDpp={};

function showSection(sec){
  document.querySelectorAll(".section").forEach(s => s.classList.add("hidden"));
  document.getElementById(sec+"-section").classList.remove("hidden");
}

// -------------- POPUP -----------------
function openPopup(title, thumb){
  document.getElementById("popup-title").innerText = title;
  document.getElementById("popup-thumb").src = thumb;
  document.getElementById("popup").style.display = "flex";
}
function closePopup(){
  document.getElementById("popup").style.display = "none";
}

// ----------- BANNERS ----------- 
function loadBanners(){
  const area=document.getElementById("banner-area");
  area.innerHTML="";

  db.ref("banners").on("value",snap=>{
    area.innerHTML="";
    snap.forEach(child=>{
      const url=child.val().url;
      area.innerHTML+=`<img src="${url}" class="banner-slide">`;
    });
  });
}

// ----------- CATEGORY DROPDOWN ----------- 
function loadCategories(){
  const select=document.getElementById("category-filter");
  select.innerHTML=`<option value="">All Categories</option>`;

  db.ref("categories").on("value",snap=>{
    select.innerHTML=`<option value="">All Categories</option>`;
    snap.forEach(child=>{
      const name=child.val().name;
      allCategories[child.key]=name;
      select.innerHTML+=`<option value="${name}">${name}</option>`;
    });
    renderAll();
  });

  select.addEventListener("change",renderAll);
}

// ----------- PROJECTS ----------- 
function renderProjects(){
  const list=document.getElementById("projects-list");
  const filter=document.getElementById("category-filter").value;
  list.innerHTML="";

  Object.entries(allProjects).forEach(([id,p])=>{
    if(filter && p.category!==filter) return;

    list.innerHTML += `
      <div class="card">
        <img src="${p.posterUrl}" class="poster">
        <div class="p-3">
          <p class="font-bold">${p.title}</p>
          <p class="text-gray-400 text-sm">${p.year}</p>

          ${
            p.watchLink
            ? `<a href="${p.watchLink}" target="_blank" class="open-link">Watch</a>`
            : ""
          }
        </div>
      </div>
    `;
  });
}

// ----------- NOTES ----------- 
function renderNotes(){
  const list=document.getElementById("notes-list");
  const filter=document.getElementById("category-filter").value;
  list.innerHTML="";

  Object.entries(allNotes).forEach(([id,n])=>{
    if(filter && n.category!==filter) return;

    list.innerHTML+=`
      <div class="card p-3">
        <p class="font-bold">${n.title}</p>
        <a href="${n.url}" target="_blank" class="open-link">Open Notes</a>
      </div>
    `;
  });
}

// ----------- DPP ----------- 
function renderDpp(){
  const list=document.getElementById("dpp-list");
  const filter=document.getElementById("category-filter").value;
  list.innerHTML="";

  Object.entries(allDpp).forEach(([id,d])=>{
    if(filter && d.category!==filter) return;

    list.innerHTML+=`
      <div class="card p-3">
        <p class="font-bold">${d.title}</p>
        <a href="${d.url}" target="_blank" class="open-link">Open DPP</a>
      </div>
    `;
  });
}

let firstLoad = true;

// ----------- LIVE FIREBASE DATA ----------- 
function startLive(){
  db.ref("projects").on("value",snap=>{
    const oldCount = Object.keys(allProjects).length;
    allProjects=snap.val()||{};
    const newCount = Object.keys(allProjects).length;

    if(!firstLoad && newCount > oldCount){
      const lastItem = Object.values(allProjects).slice(-1)[0];
      openPopup(lastItem.title, lastItem.posterUrl);
    }
    renderProjects();
  });

  db.ref("notes").on("value",snap=>{
    const oldCount = Object.keys(allNotes).length;
    allNotes=snap.val()||{};
    const newCount = Object.keys(allNotes).length;

    if(!firstLoad && newCount > oldCount){
      const lastItem = Object.values(allNotes).slice(-1)[0];
      openPopup(lastItem.title, lastItem.url);
    }
    renderNotes();
  });

  db.ref("dpp").on("value",snap=>{
    const oldCount = Object.keys(allDpp).length;
    allDpp=snap.val()||{};
    const newCount = Object.keys(allDpp).length;

    if(!firstLoad && newCount > oldCount){
      const lastItem = Object.values(allDpp).slice(-1)[0];
      openPopup(lastItem.title, lastItem.url);
    }
    renderDpp();
  });

  firstLoad = false;
}

function renderAll(){
  renderProjects();
  renderNotes();
  renderDpp();
}

// INIT
loadBanners();
loadCategories();
startLive();
</script>

</body>
</html>
